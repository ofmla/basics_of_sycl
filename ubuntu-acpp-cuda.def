Bootstrap: docker
From: ubuntu:22.04

%post
  echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections

# CUDA compiler
  apt-get update \
  && apt-get install -y build-essential python3 git cmake vim lsb-release wget software-properties-common gnupg \
  && apt-get install -y --no-install-recommends libboost-fiber-dev \
  && apt-get install -y --no-install-recommends libboost-context-dev \
  && apt-get install -y --no-install-recommends libboost-test-dev \
  && apt-get install -y --no-install-recommends libnuma-dev \
  && wget -q -O cuda-keyring.deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.0-1_all.deb \
  && dpkg -i cuda-keyring.deb && rm cuda-keyring.deb \
  && apt-get -y update \
  && apt-get install -y --no-install-recommends nvidia-open \
  && apt-get install -y --no-install-recommends cuda-compiler-12-0 \
  && apt-get -y clean autoremove \
  && rm -rf /var/lib/apt/lists/*

# LLVM
  wget --no-check-certificate https://apt.llvm.org/llvm.sh \
  && chmod +x llvm.sh \
  && ./llvm.sh 16 \
  && apt install -y libclang-16-dev clang-tools-16 libomp-16-dev llvm-16-dev lld-16

# AdaptiveCpp
  git clone -c http.sslverify=false --branch v25.02.0 --single-branch https://github.com/AdaptiveCpp/AdaptiveCpp \
  && mkdir -p AdaptiveCpp/build \
  && cd AdaptiveCpp/build && cmake .. && make -j install


